<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>2. Theory &mdash; ALADYN 0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="3. Download" href="download.html" />
    <link rel="prev" title="1. Introduction" href="intro.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> ALADYN
          </a>
              <div class="version">
                0.1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">2. Theory</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#general-symmetries-of-the-problem">2.1. General symmetries of the problem</a></li>
<li class="toctree-l2"><a class="reference internal" href="#point-and-or-space-group-symmetries">2.2. Point and/or space group symmetries</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variational-approach-using-bogoliubov-s-inequality">2.3. Variational approach using Bogoliubov’s inequality</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#choice-of-variational-parameter">Choice of variational parameter</a></li>
<li class="toctree-l3"><a class="reference internal" href="#preserve-acoustic-sum-rule">Preserve acoustic sum rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#divergence-in-dynamic-displacement-correlations">Divergence in dynamic displacement correlations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="download.html">3. Download</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">4. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="run.html">5. Running FOCEX</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">6. FAQ</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ALADYN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">2. </span>Theory</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/theory.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="theory">
<h1><span class="section-number">2. </span>Theory<a class="headerlink" href="#theory" title="Permalink to this heading"></a></h1>
<p>The force constants are defined as derivatives of the potential
energy with respect to atomic displacements about their equilibrium
position. We write the potential energy in the following form:</p>
<div class="math notranslate nohighlight">
\[V = V_0 + \sum_i \Pi_i u_i +  \frac{1}{2!} \sum_{ij}\Phi_{ij} \, u_i u_j +  \frac{1}{3!} \sum_{ijk}\Psi_{ijk} \,
u_i u_j u_k + \frac{1}{4!} \sum_{ijkl}\chi_{ijkl} \, u_i u_j u_k u_l\]</div>
<p>where the roman index <span class="math notranslate nohighlight">\(i\)</span> labels the triplet <span class="math notranslate nohighlight">\((R,\tau,\alpha)\)</span> with <span class="math notranslate nohighlight">\(R\)</span>
being a translation vector of the primitive lattice, <span class="math notranslate nohighlight">\(\tau\)</span>  an atom within the
primitive unit cell, and <span class="math notranslate nohighlight">\(\alpha\)</span> the cartesian coordinate of the atomic
displacement <span class="math notranslate nohighlight">\(u\)</span>. In other words,  <span class="math notranslate nohighlight">\(u_i\)</span> is the displacement of the
atom <span class="math notranslate nohighlight">\((R,\tau)\)</span> in the direction <span class="math notranslate nohighlight">\(\alpha\)</span> from its equilibrium or
any reference position.
<span class="math notranslate nohighlight">\(\Phi,\Psi\)</span> and <span class="math notranslate nohighlight">\(\chi\)</span> are respectively the harmonic, cubic and
quartic FCs, whereas <span class="math notranslate nohighlight">\(\Pi\)</span> is the negative of the residual force on atom <span class="math notranslate nohighlight">\(i\)</span>,
and is zero if the potential energy <span class="math notranslate nohighlight">\(V\)</span> is expanded around its minimum
or equilibrium configuration.
In clusters or molecules the formalism is the same, only the
translation vector <span class="math notranslate nohighlight">\(R\)</span> needs to be dropped.</p>
<p>The resulting force on atom <span class="math notranslate nohighlight">\(i\)</span> would then be:</p>
<div class="math notranslate nohighlight">
\[F_i = - \frac{\partial V}{\partial u_i} = -\Pi_i -\sum_j  \Phi_{ij} \,u_j - \frac{1}{2} \sum_{jk}\Psi_{ijk} \,
u_j u_k - \frac{1}{3!} \sum_{jkl} \chi_{ijkl} \,  u_j u_k u_l\]</div>
<section id="general-symmetries-of-the-problem">
<h2><span class="section-number">2.1. </span>General symmetries of the problem<a class="headerlink" href="#general-symmetries-of-the-problem" title="Permalink to this heading"></a></h2>
<p>The symmetries of the FCs are deduced from
rotational and translational invariance of the system, in addition to the
symmetries of the crystal itself. These symmetries are as follows:</p>
<ol class="arabic simple">
<li><p>Invariance under the permutation of indices:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\begin{split}\Phi_{ij} &amp;= \Phi_{ji} \\
\Psi_{ijk} &amp;= \Psi_{ikj} = \Psi_{jik} = \Psi_{kji} = ... \\
\chi_{ijkl} &amp;= \chi_{ikjl}=\chi_{ijlk}=\chi_{jikl} = ...\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(i,j,k\)</span> and <span class="math notranslate nohighlight">\(l\)</span>
refer to neighboring atoms.
This comes about because the force constants are
derivatives of the potential energy, and one can change the order of
differentiation for such analytic function.</p>
<ol class="arabic simple" start="2">
<li><p>Invariance under an arbitrary translation of the system</p></li>
</ol>
<p>Translational invariance of the whole system (even if not an ordered crystal)
also implies <span class="math notranslate nohighlight">\(V(u) = V(u+c)\)</span> and <span class="math notranslate nohighlight">\(F(u) = F(u+c)\)</span> (which is easier to use)
where <span class="math notranslate nohighlight">\(u(t)\)</span> are the dynamical variables, and <span class="math notranslate nohighlight">\(c\)</span> is a constant arbitrary
shift vector (may be incommensurate with <span class="math notranslate nohighlight">\(R\)</span>).</p>
<p>This implies the well-known “acoustic sum rule” (ASR) generalized to higher order FCs:</p>
<div class="math notranslate nohighlight">
\[\begin{split}0 &amp;= \sum_{\tau} \, \Pi_{0 \tau}^{ \alpha} \,\,\, \forall (\alpha) \,\, =&gt; {\rm Total \,~force \,~on\,~unit\,~cell = 0}  \\
0 &amp;= \sum_{R_1,\tau_1} \, \Phi_{0\tau,R_1 \tau_1}^{\alpha\beta} \,\,\, \forall (\alpha\beta,\tau) \\
0 &amp;= \sum_{R_2,\tau_2} \, \Psi_{0\tau,R_1\tau_1,R_2\tau_2}^{\alpha\beta\gamma} \,\,\, \forall(\alpha\beta\gamma,R_1,\tau_1) \\
0 &amp;= \sum_{R_3,\tau_3} \, \chi_{0\tau,R_1\tau_1,R_2\tau_2,R_3\tau_3}^{\alpha\beta\gamma\delta} \,\,\,  \forall(\alpha\beta\gamma\delta,R_1R_2,\tau_1\tau_2)\end{split}\]</div>
<p>so that diagonal terms in these tensors can be defined in terms of their
off-diagonal elements, for arbitrary cartesian components.</p>
<ol class="arabic simple" start="3">
<li><p>Invariance under an arbitrary rotation of the system</p></li>
</ol>
<p>Likewise if the system is rotated arbitrarily, the total
energy and forces should not change. This leads to the following
relations <a class="reference internal" href="#ref" id="id1"><span>[Ref]</span></a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}0 &amp;= \sum_{\tau} \,  \Pi_{0 \tau}^{ \alpha}\, \tau^{\beta}\, \epsilon^{\alpha\beta\nu}, \,\,\, \forall ( \nu) \,\, ({\rm Torque \,on\,unit\,cell}=0) \\
0 &amp;=  \sum_{R_1,\tau_1} \, \Phi_{0\tau,R_1 \tau_1}^{\alpha\beta}\, (R_1\tau_1)^{\gamma}\, \epsilon^{\beta\gamma\nu}
 + \Pi_{0 \tau}^{ \beta }\, \epsilon^{\beta \alpha \nu}  \,\,\, \forall (\alpha\nu,\tau) \\
0 &amp;= \sum_{R_2,\tau_2} \, \Psi_{0\tau,R_1\tau_1,R_2\tau_2}^{\alpha\beta\gamma} \, (R_2\tau_2)^{\delta} \, \epsilon^{\gamma\delta\nu} + \Phi_{0\tau,R_1\tau_1}^{\gamma\beta}\, \epsilon^{\gamma\alpha\nu}  + \Phi_{0\tau,R_1\tau_1}{\alpha\gamma}\, \epsilon^{\gamma\beta\nu} \,\,\, \forall(\alpha\nu,R_1,\tau\tau_1) \\
0 &amp;= \sum_{R_3\tau_3}\, \chi_{0\tau,R_1\tau_1,R_2\tau_2,R_3\tau_3}^{\alpha\beta\gamma\delta}\,
(R_3\tau_3)^{\mu}\, \epsilon^{\delta\mu\nu}
+ \, \Psi_{0\tau,R_1\tau_1,R_2\tau_2}^{\delta\beta\gamma} \,\epsilon^{\delta\alpha\nu} +
 \, \Psi_{0\tau,R_1\tau_1,R_2\tau_2}^{\alpha\delta\gamma} \,\epsilon^{\delta\beta\nu}   \\
&amp; \quad + \, \Psi_{0\tau,R_1\tau_1,R_2\tau_2}^{\alpha\beta\delta} \,\epsilon^{\delta\gamma\nu}
\,\, \, \forall(\alpha\nu,R_1R_2,\tau\tau_1\tau_2)\end{split}\]</div>
<p>Here <span class="math notranslate nohighlight">\(\epsilon^{\alpha\beta\gamma}\)</span> is the anti-symmetric Levy-Civita symbol, and
<span class="math notranslate nohighlight">\((R\tau)^{\alpha}\)</span> refers to the cartesian component <span class="math notranslate nohighlight">\(\alpha\)</span> of the reference position
vector of the atom <span class="math notranslate nohighlight">\(\tau\)</span> in unit cell defined by <span class="math notranslate nohighlight">\(R\)</span>. Moreover, an implicit
summation over repeated cartesian indices is implied.</p>
<p>As we see, rotational invariance relates the second to the
third order terms, and the third to the fourth order terms, implying that
if the expansion of the potential energy is truncated after the fourth order
terms, we need to start with the fourth order terms, and application of
rotational invariance rules will give us constraints on third and
second order FCs respectively.</p>
</section>
<section id="point-and-or-space-group-symmetries">
<h2><span class="section-number">2.2. </span>Point and/or space group symmetries<a class="headerlink" href="#point-and-or-space-group-symmetries" title="Permalink to this heading"></a></h2>
<p>The other constraints come from symmetry operations, such as lattice
translation, rotation, mirror
or any symmetry operation of the space and/or point group of the crystal and/or molecule
which leaves the latter invariant.
Invariance under a translation of the system by any translation
lattice vector <span class="math notranslate nohighlight">\(R\)</span> implies the following relations:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\Pi_{R\tau}^{\alpha} &amp;= \Pi_{0 \tau}^{ \alpha} \,\, \forall (R \tau \alpha)  \\
\Phi_{R\tau,R_1\tau_1}^{\alpha\beta} &amp;= \Phi_{0 \tau ,R_1-R \tau_1}^{\alpha\beta}  \\
\Psi_{R\tau,R_1\tau_1,R_2\tau_2}^{\alpha\beta\gamma} &amp;= \Psi_{0 \tau ,R_1-R \tau_1,R_2-R \tau_2}^{\alpha\beta\gamma}  \\
\chi_{R\tau,R_1\tau_1,R_2\tau_2,R_3\tau_3}^{\alpha\beta\gamma\delta} &amp;= \chi_{0 \tau ,R_1-R \tau_1,R_2-R \tau_2, R_3-R \tau_3}^{\alpha\beta\gamma\delta}\end{split}\]</div>
<p>So in an ideal crystal, this reduces the number of force constants considerably
(by the number of unit cells, to be exact), meaning that we will use for the atoms in all the other cells the same FCs
as those we have kept for the atoms in the “central” cell.</p>
<p>If a rotation or mirror symmetry operation is denoted by <span class="math notranslate nohighlight">\(S\)</span>,
we must have:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\Pi_{S\tau}^{\alpha} &amp;= \sum_{\alpha'} \,\Pi_{\tau}^{\alpha'} \, {\cal S}_{\alpha,\alpha'} \\
\Phi_{ S\tau, S\tau_1}^{\alpha\beta} &amp;= \sum_{\alpha'\beta'} \,\Phi_{\tau,\tau_1}^{\alpha'
\beta'} \, {\cal S}_{\alpha,\alpha'}\, {\cal S}_{\beta,\beta' }  \\
\Psi_{ S\tau, S\tau_1, S\tau_2}^{\alpha\beta\gamma} &amp;= \sum_{\alpha'\beta'\gamma'} \,\Psi_{\tau,\tau_1\tau_2}^{\alpha' \beta'\gamma'} \, {\cal S}_{\alpha,\alpha'}\, {\cal S}_{\beta,\beta' } \, {\cal S}_{\gamma,\gamma' }   \\
\chi_{ S\tau, S\tau_1, S\tau_2, S\tau_3}^{\alpha\beta\gamma\delta} &amp;= \sum_{\alpha'\beta'\gamma'\delta'} \,\chi_{\tau,\tau_1,\tau_2,\tau_3}^{\alpha' \beta' \gamma' \delta'} \, {\cal S}_{\alpha,\alpha'}\, {\cal S}_{\beta,\beta' } \, {\cal S}_{\gamma,\gamma'}\, {\cal S}_{\delta,\delta' }\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\({\cal S}_{\alpha,\alpha'}\)</span> are the <span class="math notranslate nohighlight">\(3\times3\)</span> matrix elements of the
symmetry operation <span class="math notranslate nohighlight">\(S\)</span>.
These symmetry relations impose a linear set of constraints on the force
constants.</p>
<p>Any physically correct model of force constants
must satisfy the invariance relations. On the other hand, we do
approximations by truncating the range of FCs and their order in the
Taylor expansion of the potential. Therefore imposing the constraints
will move their value away from the true value, but has the advantage
that they are physically correct, and will for instance reproduce the linear
dispersion of acoustic phonons near <span class="math notranslate nohighlight">\(k=0\)</span>. So one should keep in mind
that an unrealistic truncation to a too short of a range will produce
results in disagreement with experiments.</p>
</section>
<section id="variational-approach-using-bogoliubov-s-inequality">
<h2><span class="section-number">2.3. </span>Variational approach using Bogoliubov’s inequality<a class="headerlink" href="#variational-approach-using-bogoliubov-s-inequality" title="Permalink to this heading"></a></h2>
<p>Bogoliubov’s inequality</p>
<div class="math notranslate nohighlight">
\[F\le F_{trial}= F_0 +\langle V-V_0 \rangle_0\]</div>
<p>The sharp brackets in above equation mean thermal average with respect to the density matrix <span class="math notranslate nohighlight">\(\rho_0\)</span> associated with the variational or trial harmonic Hamiltonian <span class="math notranslate nohighlight">\(H_0\)</span></p>
<div class="math notranslate nohighlight">
\[\langle A \rangle_0=Tr \rho_0 A; \,\, \rho_0=e^{-H_0/kT} /Z ; \,\, Z={\rm Tr}\, e^{-H_0/kT} ;\, F_0=-kT {\rm ln} Z\]</div>
<p>As can be seen in above equations, <span class="math notranslate nohighlight">\(\rho_0\)</span> is the trial density matrix and Z is the corresponding partition function. <span class="math notranslate nohighlight">\(F_{trial}\)</span> is the effective or trial free energy that is optimized during iterations. <span class="math notranslate nohighlight">\(F_0\)</span> and <span class="math notranslate nohighlight">\(V_0\)</span> are the trial harmonic free energy and potential energy. <span class="math notranslate nohighlight">\(V\)</span> is the (approximated) real or actual potential energy in a Taylor expansion form to describe the real crystal with force constants <span class="math notranslate nohighlight">\(\Phi\)</span>,:math:<cite>Psi</cite> and <span class="math notranslate nohighlight">\(X\)</span> and selected variational parameters (strain, internal coordinates).</p>
<p>In order to include structural phase transitions and thermal expansion, we introduce two additional sets of variational parameters: the strain tensor <span class="math notranslate nohighlight">\(\eta\)</span> and <span class="math notranslate nohighlight">\(u_i^0\)</span>, the internal relaxation of atoms beyond the strain effect (captured by <span class="math notranslate nohighlight">\(\eta R_i\)</span> due to changes in the unit cell shape or volume, and so that the general displacement of atom <span class="math notranslate nohighlight">\(i\)</span> from its reference position as a result of cell deformation can be written as: <span class="math notranslate nohighlight">\(u_i(t) = \eta R_i + u_i^0 + (1+\eta) y_i(t)=  S_i+ y_i(t)\)</span> where <span class="math notranslate nohighlight">\(y_i\)</span> means the dynamic displacement of atom i, so by definition :math:` langle y_i rangle_0 =0`. <span class="math notranslate nohighlight">\(R_i\)</span> refers to the lattice translation vector of cell containing <span class="math notranslate nohighlight">\(i\)</span>. <span class="math notranslate nohighlight">\(S_i=  \eta R_i + u_i^0\)</span> is the static displacement of atom <span class="math notranslate nohighlight">\(i\)</span> introduced for brevity of notations.
The trial harmonic potential contains the variational parameters <span class="math notranslate nohighlight">\(K_{ij}\)</span> and is defined as:</p>
<div class="math notranslate nohighlight">
\[V_0 =\sum_{ij} \,\frac{1}{2!} K_{ij}\, y_i\, y_j\]</div>
<p>For the trial harmonic Hamiltonian, the free energy can be calculated analytically:</p>
<div class="math notranslate nohighlight">
\[F_0= kT \sum_{\lambda} {\rm ln} \left[ 2 {\rm sinh} \frac{\beta \hbar \omega_{\lambda} }{2}\right]\]</div>
<p>where <span class="math notranslate nohighlight">\(\beta=1/k_BT\)</span> and :math:` omega_{la} ` is the harmonic frequency of mode <span class="math notranslate nohighlight">\(\lambda\)</span> obtained from diagonalizing the dynamical matrix associated with the trial force constants:  <span class="math notranslate nohighlight">\(D(k) = \sum_R \frac{K_{ij}}{\sqrt {m_i m_j}}\, \epsilon^{i k \cdot (R_i-R_j)}\)</span>. <span class="math notranslate nohighlight">\(k\)</span> refers to the k vector on a selected k mesh in reciprocal space. The matrix <span class="math notranslate nohighlight">\(D\)</span> being Hermitian, it has real eigenvalues denoted by <span class="math notranslate nohighlight">\(\omega_{\lambda}^2\)</span> and eigenvectors <span class="math notranslate nohighlight">\(epsilon_{i\alpha,\lambda}\)</span> where <span class="math notranslate nohighlight">\(\alpha\)</span> is the cartesian coordinate and <span class="math notranslate nohighlight">\(\lambda\)</span> refers to the vibrational mode (<span class="math notranslate nohighlight">\(i\alpha\)</span> can be understood as line index and <span class="math notranslate nohighlight">\(\lambda\)</span> a the column index of the unitary eigenvector matrix <span class="math notranslate nohighlight">\(e\)</span>). We also need the thermal averages of the trial and anharmonic potentials <span class="math notranslate nohighlight">\(V_0\)</span> and <span class="math notranslate nohighlight">\(V\)</span>. In terms of the eigenvalues  and eigenvectors of the above dynamical matrix, we have:</p>
<div class="math notranslate nohighlight" id="equation-yy">
<span class="eqno">(1)<a class="headerlink" href="#equation-yy" title="Permalink to this equation"></a></span>\[ \langle y_i^\alpha y_j^\beta \rangle= \frac{\hbar}{2} \sum_{k,\la}  \frac{ (2 n_{\lambda}+1) }{\omega_{k\lambda}} \,\frac{\epsilon_{i\alpha,\lambda} \, \epsilon_{j\beta,\lambda}^\dagger}{\sqrt{m_i m_j}}e^{i\vec{k}\cdot(\vec{R}_j-\vec{R}_i)}\]</div>
<p>Thus the thermal averaged harmonic or trial potential <span class="math notranslate nohighlight">\(\langle V_0\rangle\)</span> can be simply written into <span class="math notranslate nohighlight">\(\langle V_0 \rangle = \sum_{ij} \,\frac{1}{2!} K_{ij}\, \langle y_i y_j \rangle \)</span>langle Vrangle` can be presented in Eq.[ref{Vaverage}] as:</p>
<div class="math notranslate nohighlight" id="equation-vaverage">
<span class="eqno">(2)<a class="headerlink" href="#equation-vaverage" title="Permalink to this equation"></a></span>\[\begin{split}\langle V \rangle &amp;= \frac{1}{2}\sum_{ij} \,  \Phi_{ij}\, \Big(( S_i S_j+ \langle y_i\, y_j \rangle \Big)
+ \frac{1}{6}\sum_{ijk}  \Psi_{ijk}\,\Big(S_i S_j + 3 \langle y_i \,y_j \rangle \Big) \,S_k \nonumber\\
&amp;+\frac{1}{24} \sum_{ijkl}  X_{ijkl}\, \Big( S_i S_j S_k S_l + 6 S_i S_j \langle y_k \,y_l \rangle +  \langle y_i y_j y_k  y_l \rangle \Big)\end{split}\]</div>
<p>For the sake of simplicity, all the cartesian related notations have been  symmetrized and omitted. In fact, terms like <span class="math notranslate nohighlight">\(\eta\)</span> are rank 2 tensors in cartesian coordinates which means all the matrix multiplications and gradients calculations have to been handled carefully in real code implementation.</p>
<section id="choice-of-variational-parameter">
<h3>Choice of variational parameter<a class="headerlink" href="#choice-of-variational-parameter" title="Permalink to this heading"></a></h3>
<p>From here we can use variational approach in an iterative manner to
minimize the trial Free energy <span class="math notranslate nohighlight">\(F_{trial}\)</span> by solving the
gradients of it with respect to different variational parameters. The
Broyden method is being used in the code for this non-linear root
finding process. As mentioned previously, the variational parameters in
this formalism are internal relaxation of atoms <span class="math notranslate nohighlight">\(u_i^0\)</span>, strain
tensor <span class="math notranslate nohighlight">\(\eta\)</span> and trial harmonic force constants <span class="math notranslate nohighlight">\(K_{ij}\)</span>.
Thus we have the following gradients formulas resulting from the
minimization condition:</p>
<div class="math notranslate nohighlight" id="equation-dfdu">
<span class="eqno">(3)<a class="headerlink" href="#equation-dfdu" title="Permalink to this equation"></a></span>\[\frac{\partial F_{trial} }{\partial u_i^0 } =\frac{\partial  \langle V \rangle }{\partial u_i^0 } =0\]</div>
<div class="math notranslate nohighlight" id="equation-dfdeta">
<span class="eqno">(4)<a class="headerlink" href="#equation-dfdeta" title="Permalink to this equation"></a></span>\[\frac{\partial F_{trial} }{\partial \eta } =\frac{\partial \langle V \rangle }{\partial \eta }=0\]</div>
<div class="math notranslate nohighlight" id="equation-dfdk">
<span class="eqno">(5)<a class="headerlink" href="#equation-dfdk" title="Permalink to this equation"></a></span>\[\frac{\partial F_{trial} }{\partial K_{ij} }  =0\]</div>
<p>Same as before, cartesian related labelling and notations are overly
symmetrized and omitted for better readability. Eq. <a class="reference internal" href="#equation-dfdu">(3)</a>
and Eq. <a class="reference internal" href="#equation-dfdeta">(4)</a> are straightforward and self-explanatory
equilibrium conditions; these are implemented in codes following the
exact representations which are easy to understand and to maintain.
However, these exact representations are omitted here as they could be
easily formulated from Eq. <a class="reference internal" href="#equation-vaverage">(2)</a>. What worth
mentioning is the third gradients Eq. <a class="reference internal" href="#equation-dfdk">(5)</a> since trial
force constant <span class="math notranslate nohighlight">\(K_{ij}\)</span>, although being a variational parameter,
is implicit in the expression <span class="math notranslate nohighlight">\(F_{trial}\)</span> because of the term
<span class="math notranslate nohighlight">\(\langle y_i y_j\rangle\)</span>. Refer to Eq. <a class="reference internal" href="#equation-yy">(1)</a>, using the
identity
<span class="math notranslate nohighlight">\(2 n_{\lambda}+1= {\rm coth} \frac{ \beta \hbar \omega_{\lambda} }{2}\)</span>,
one can see that <span class="math notranslate nohighlight">\(\langle y_i y_j\rangle\)</span> is a function of
eigenvalues <span class="math notranslate nohighlight">\(\omega_\lambda\)</span> and eigenvectors
<span class="math notranslate nohighlight">\(e_{i\alpha,\lambda}\)</span>, they both originated from diagonalization
of dynamical matrix D(k) while D(k) itself depends solely on the trial
force constant <span class="math notranslate nohighlight">\(K_{ij}\)</span>. So it’s not easy to write out
Eq. <a class="reference internal" href="#equation-dfdk">(5)</a> in an explicit way that is necessary for code
implementation. However, by incorporating chain rule and
the free energy equation, we find a one to one equivalence
between Eq. <a class="reference internal" href="#equation-dfdk">(5)</a> and the following equation:</p>
<div class="math notranslate nohighlight" id="equation-dfdk2">
<span class="eqno">(6)<a class="headerlink" href="#equation-dfdk2" title="Permalink to this equation"></a></span>\[\frac{\partial \langle V \rangle }{\partial \langle y_iy_j\rangle } - \frac{1}{2} K_{ij} =0 \label{dfdk2}\]</div>
<p>Apparently, Eq. <a class="reference internal" href="#equation-vaverage">(2)</a> shows that
<span class="math notranslate nohighlight">\(\langle V\rangle\)</span> is an explicit polynomial of
<span class="math notranslate nohighlight">\(\langle yy\rangle\)</span>, so this new equation can be easily translated
into codes in a straightforward way. One should be aware that,
Eq. <a class="reference internal" href="#equation-dfdk2">(6)</a> is by no means a ’gradient’ formula of
anything. It’s just a one to one correspondence to
Eq. <a class="reference internal" href="#equation-dfdk">(5)</a>, in other words, if Eq. <a class="reference internal" href="#equation-dfdk">(5)</a> is
satisfied (after fully optimizing the free energy), then
Eq. <a class="reference internal" href="#equation-dfdk2">(6)</a> will simultaneously be satisfied, and vice
versa. There are no further physical significance behind
Eq. <a class="reference internal" href="#equation-dfdk2">(6)</a>. In fact, the trial force constants
<span class="math notranslate nohighlight">\(K_{ij}\)</span> and the thermally averaged dynamic displacement
<span class="math notranslate nohighlight">\(\langle y_i y_j \rangle\)</span> can be considered interchangeable from a
mathematical standpoint. This provides two options when selecting the
variational parameters for self-consistent computations. The advantage
of using <span class="math notranslate nohighlight">\(\langle y_i y_j \rangle\)</span> becomes more evident as it
directly appears as explicit parameters in the potential energy
expression in Eq. <a class="reference internal" href="#equation-vaverage">(2)</a>, unlike the trial force
constants <span class="math notranslate nohighlight">\(K_{ij}\)</span>, which do not have a direct manifestation in
energy or gradient formulas.</p>
<p>Some may argue that a significant benefit of favoring
<span class="math notranslate nohighlight">\(\langle y_i y_j \rangle\)</span> over <span class="math notranslate nohighlight">\(K_{ij}\)</span> is that it
eliminates the need for diagonalizing the dynamic matrix from
<span class="math notranslate nohighlight">\(K_{ij}\)</span> to obtain new sets of phonon frequencies, thus bypassing
the entire computation in reciprocal space, which by employing the
Broyden method, the new value of <span class="math notranslate nohighlight">\(\langle y_i y_j \rangle\)</span> can be
obtained straightforwardly. However, there are three main reasons why it
is preferable to still use trial force constants <span class="math notranslate nohighlight">\(K_{ij}\)</span> as
variational parameters instead of <span class="math notranslate nohighlight">\(\langle y_i y_j \rangle\)</span>.
First, as discussed earlier, there is a possibility of divergent
<span class="math notranslate nohighlight">\(\langle y_i y_j \rangle\)</span> values for certain k points, especially
the gamma point. This could make it challenging for the quasi-Newton
iterative method to reconcile these outlier
<span class="math notranslate nohighlight">\(\langle y_i y_j \rangle\)</span> values with the remaining normal
<span class="math notranslate nohighlight">\(\langle y_i y_j \rangle\)</span> values, leading to convergence
difficulties. On the other hand, by choosing <span class="math notranslate nohighlight">\(K_{ij}\)</span> as the
variational parameter, it becomes possible to regulate these abnormal
<span class="math notranslate nohighlight">\(\langle y_i y_j \rangle\)</span> values using the aforementioned
analytical approximation, resulting in a smoother free energy landscape
that facilitates the Broyden method in finding the global minimum.
Second, using <span class="math notranslate nohighlight">\(\langle y_i y_j \rangle\)</span> as the variational
parameter means bypassing the examination of phonon frequencies within
iterations. This eliminates the ability to assess the stability of
phonons at each iteration, potentially leading to the computation
becoming trapped in an unstable structure. Third, from a mathematical
perspective, finding an appropriate way to update the
<span class="math notranslate nohighlight">\(K_{ij}\)</span>term in Eq. <a class="reference internal" href="#equation-dfdk2">(6)</a> without falling into
circular reasoning poses a challenge. In fact, it is analytically more
feasible to calculate <span class="math notranslate nohighlight">\(\langle y_i y_j \rangle\)</span> from trial force
constants <span class="math notranslate nohighlight">\(K_{ij}\)</span> than the other way around.</p>
</section>
<section id="preserve-acoustic-sum-rule">
<h3>Preserve acoustic sum rule<a class="headerlink" href="#preserve-acoustic-sum-rule" title="Permalink to this heading"></a></h3>
<p>The acoustic sum rule holds significant importance in this computational
approach, and it can pose considerable challenges when attempting to
enforce it using real space Taylor series methods. Nevertheless, during
the self-consistent calculation, it is unnecessary to enforce it if the
initial input data already adheres to the acoustic sum rule (for the
sake of simplicity, it will be referred as ASR henceforth), which can be
found in <a class="reference internal" href="#esfarjani2018" id="id2"><span>[Esfarjani2018]</span></a> since
it originates from translational invariance. The trial force constants
<span class="math notranslate nohighlight">\(K_{ij}\)</span> can be expressed as:</p>
<div class="math notranslate nohighlight" id="equation-trialfc">
<span class="eqno">(7)<a class="headerlink" href="#equation-trialfc" title="Permalink to this equation"></a></span>\[K_{i,j}^{\alpha,\beta} \approx\;\; \Phi_{i,j}^{\alpha,\beta} + \sum_{k}\Psi_{i,j,k}^{\alpha,\beta,\gamma}(S_k^\gamma- S_i^\gamma)+
   \frac{1}{4}\sum_{k,l}X_{i,j,k,l}^{\alpha,\beta,\gamma,\delta} [(S_k-S_i)^\gamma(S_l-S_i)^\delta + \langle y_k^\gamma y_l^\delta \rangle]
   \label{eq:trialFC}\]</div>
<p>which needs to preserve the ASR across the whole iterative procedures of
Broyden method. Thus, each term in Eq. <a class="reference internal" href="#equation-trialfc">(7)</a>
needs to satisfy ASR independently. The first term is trivial as long as
the input real force constant <span class="math notranslate nohighlight">\(\Phi_{i,j}^{\alpha,\beta}\)</span>
satisfies ASR. For the second term, we can switch the position of
indexes into
<span class="math notranslate nohighlight">\(\sum_{j}\,\sum_{k}\Psi_{i,j,k}^{\alpha,\beta,\gamma}S_k^{\gamma} = \sum_{k}S_{k}^\gamma\,\sum_{j}\Psi_{i,j,k}^{\alpha,\beta,\gamma}\)</span>,
which means the only requirement is the same: input cubic force
constants <span class="math notranslate nohighlight">\(\Psi\)</span> has to satisfy ASR. A similar line of reasoning
can be applied to the final term in Eq. <a class="reference internal" href="#equation-trialfc">(7)</a>
thus establishing that the trial force constant <span class="math notranslate nohighlight">\(K_{i,j}\)</span> despite
its lack of symmetry and unrestricted variability, automatically
satisfies the acoustic sum rule (ASR) during the self-consistent
iterations. This raises the question of how we can ensure or enforce the
ASR in the input force constants data, namely <span class="math notranslate nohighlight">\(\Phi, \Psi, X\)</span>.
Several subroutines are specifically implemented for this task, based on
the idea that is to assign specific values to those force constants that
involve identical atomic indexes. The rules that can also be found in
the source code file ’force_update.f90’, are written as below:</p>
<div class="math notranslate nohighlight">
\[\begin{split}&amp;\Phi_{i,i} = -\sum_{j,j\neq i}\Phi_{i,j},\; \forall i \\
\\
&amp;\text{  } \begin{cases}
\Psi_{i,j,j} = -\sum_{k,i\neq j, k\neq j}\Psi_{i,j,k}, \;\forall i,j \nonumber \\
\Psi_{i,i,k} = -\sum_{j,i\neq j, k\neq i}\Psi_{i,j,k}, \; \forall i,k \nonumber \\
\Psi_{i,i,i} = -\sum_{k,k\neq i}\Psi_{i,i,k}, \;\forall i \nonumber \\
\end{cases}\\
\\
&amp;\text{  } \begin{cases}
X_{i,j,k,k} = -\sum_{l,k\neq j, k\neq i, j\neq i,l\neq k}X_{i,j,k,l}, \; \forall i,j,k \nonumber \\
X_{i,j,j,l} = -\sum_{k,l\neq j, l\neq i, j\neq i,k\neq j}X_{i,j,k,l}, \; \forall i,j,l \nonumber \\
X_{i,j,j,j} = -\sum_{l,j\neq i, l\neq j }X_{i,j,j,l}, \; \forall i,j \nonumber \\
X_{i,i,k,l} = -\sum_{j,k\neq i, l\neq i, j\neq i}X_{i,j,k,l}, \; \forall i,k,l \nonumber \\
X_{i,i,i,i} = -\sum_{l,l\neq i}X_{i,i,i,l}, \; \forall i
\end{cases}\end{split}\]</div>
<p>With this in mind, a translational form modification should also be
exerted on the potential energy formula
Eq. <a class="reference internal" href="#equation-vaverage">(2)</a> and the free energy
gradient formulas Eq. <a class="reference internal" href="#equation-dfdu">(3)</a>, Eq. <a class="reference internal" href="#equation-dfdeta">(4)</a>
and Eq. <a class="reference internal" href="#equation-dfdk">(5)</a>. This can be done by replacing the every
occurrence of statistic displacement product <span class="math notranslate nohighlight">\(S_iS_j\)</span> with
<span class="math notranslate nohighlight">\(-\frac{1}{2}(S_j-S_i)^2\)</span> and etc, similar to
Eq. <a class="reference internal" href="#equation-trialfc">(7)</a> which is already in this
translational invariant representation. This will inevitably lead to a
more complicated expression especially for the gradient formulas, but it
works the best with the input force constants data generated by
<strong>FOCEX</strong> and has the minimum numerical deficiencies. The explicit
formulas are skipped here for the purpose of this paper, but can be
found in the source code file ’VA_math.f95’.</p>
</section>
<section id="divergence-in-dynamic-displacement-correlations">
<h3>Divergence in dynamic displacement correlations<a class="headerlink" href="#divergence-in-dynamic-displacement-correlations" title="Permalink to this heading"></a></h3>
<p>In the numerical computation of dynamic displacements correlation
<span class="math notranslate nohighlight">\(\langle y_i^\alpha y_j^\beta\rangle\)</span>, certain divergences will
happen, perforce, due to the gamma point (k=0) term in the sum in
formula Eq. <a class="reference internal" href="#equation-yy">(1)</a>. The reason behind this is that
<span class="math notranslate nohighlight">\(\omega_{k=0,\lambda=acoustic}\)</span> should be 0 determined by the ASR.
Also notice that the Bose-Einstein coefficient
<span class="math notranslate nohighlight">\(n_\lambda = (e^{\beta\hbar\omega_{k\lambda)}}-1)^-1\)</span> will also
diverge for small phonon frequency at high temperature limit. To address
this matter in a more suitable manner, we attempted to resolve it by
excluding the gamma point term and substituting it with a spherical
integral. This integral can be analytically derived as a function of
temperature. It is well-established that at the gamma point, only the
three acoustic phonon bands, including one longitudinal and two
transverse modes, tend to approach zero. The 3 eigenvectors
<span class="math notranslate nohighlight">\(\epsilon_\lambda^{\tau\alpha}\)</span> at gamma point should satisfy
<span class="math notranslate nohighlight">\(\sum_{\tau\alpha}e_{\lambda}^{\tau\alpha}e_{\lambda'}^{\tau\alpha}=\delta_{\lambda\lambda'}\)</span>
where <span class="math notranslate nohighlight">\(\lambda\)</span> can be (1,2,3) or <span class="math notranslate nohighlight">\((//,\perp_1,\perp_2)\)</span>
that corresponds to 1 longitudinal and 2 transverse modes at gamma
point. The sets of eigenvectors
<span class="math notranslate nohighlight">\(\{\epsilon_{//},\epsilon_{\perp1},\epsilon_{\perp2}\}\)</span> are
arbitrarily based on this rule. For this code package, we choose the
following set:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{cases}
        \epsilon_{//}=(sin\theta cos\phi,sin\theta sin\phi,cos\theta)\\
        \epsilon_{\perp1}=(cos\theta cos\phi,cos\theta sin\phi, -sin\theta)\\
        \epsilon_{\perp2}=(-sin\phi,cos\phi)
    \end{cases}\end{split}\]</div>
<p>Taking that into consideration, now Eq. <a class="reference internal" href="#equation-yy">(1)</a> can be written
into:</p>
<div class="math notranslate nohighlight">
\[&lt;y_{0\tau_i}^\alpha y_{R\tau_j}^\beta&gt; =  \frac{1}{N_k\sqrt{m_{\tau_i}m_{\tau_j}}} \sum_{\lambda,k\ne0}[\frac{\hbar}{2\omega_{k\lambda}}(2n_{k\lambda}+1)\epsilon_{k\lambda}^{\dagger\alpha}(\tau_i)\epsilon_{k\lambda}^{\beta}(\tau_j)cos(\vec{k}\cdot\vec{R}_j)]+\text{$\gamma$\;point fix}\]</div>
<p>where the ’<span class="math notranslate nohighlight">\(\gamma\)</span> point fix’ part can be approximated properly
in an isotropic spherical integral shown below (call it
<span class="math notranslate nohighlight">\(I_{0\tau_i,R\tau_j}^{\alpha\beta}\)</span>):</p>
<div class="math notranslate nohighlight">
\[\begin{aligned}
     I_{0\tau_i,R\tau_j}^{\alpha\beta} &amp;\approx \frac{1}{N_0N_k\sqrt{m_{\tau_i}m_{\tau_j}}}\sum_{Acoustic}\iiint\frac{\hbar}{2\omega_{k\rightarrow 0,\lambda}}(2n_{k\rightarrow 0\lambda}+1)\epsilon_\lambda^\alpha \epsilon_\lambda^\beta e^{i\vec{k}\cdot(\vec{R}_2-\vec{R}_1)}_{(k\rightarrow 0)}dv+...\nonumber
\end{aligned}\]</div>
<p>here <span class="math notranslate nohighlight">\(N_0\)</span> means the number of atom in a unit cell, <span class="math notranslate nohighlight">\(N_k\)</span> is
the size of k-mesh. It can be proved that for this matrix
<span class="math notranslate nohighlight">\(I_{0\tau_i,R\tau_j}\)</span>, all the off-diagonal terms are 0 only the
xx, yy and zz component remain non-zero. A series of estimation can be
utilized given that small k point condition and high temperature limit:</p>
<ul class="simple">
<li><p>Term
<span class="math notranslate nohighlight">\(\frac{\hbar}{2\omega_{k\lambda}}(2n_{k\lambda}+1)=\frac{\hbar}{2\omega_{k\lambda}}coth\frac{\beta\hbar\omega_{k\lambda}}{2}\approx\frac{k_B T}{\omega_{k\lambda}^2}=\frac{k_BT}{C_\lambda^2 k^2}\)</span>
given small <span class="math notranslate nohighlight">\(\hbar\omega/k_BT\)</span></p></li>
<li><p>This spherical integral is over Brillouin zone(BZ) substitute
<span class="math notranslate nohighlight">\(I\simeq \frac{1}{\Delta^3}\int_0^{K_\Delta}d^3k\frac{...}{k^2}=\frac{4\pi K_\Delta}{\Delta^3}\)</span></p></li>
<li><p>Notice that one BZ mesh volume
<span class="math notranslate nohighlight">\(\Delta^3=\frac{4\pi K_{\Delta}^3}{3}=\frac{\Omega_g}{N_k}\)</span> so
above result is just <span class="math notranslate nohighlight">\(\frac{3}{K_\Delta^2}\)</span></p></li>
<li><p>The exponential term can be simplified to 1 given the fact that k is
approaching 0. Notice that an analytic result is still easy to
formulate even without this simplification.</p></li>
</ul>
<p>As a result, we end up with the final gamma point approximation formula
stated below:</p>
<div class="math notranslate nohighlight" id="equation-gammafix">
<span class="eqno">(8)<a class="headerlink" href="#equation-gammafix" title="Permalink to this equation"></a></span>\[\begin{split}\begin{aligned}
   \text{xx or yy direction   }I_{0\tau_i,R\tau_j}^{xx\text{ or }yy} &amp;=\frac{1}{N_k\sqrt{m_{\tau_i}m_{\tau_j}}}\frac{3k_BT}{N_0K_{\Delta}^2}(\frac{1}{3C_{//}^2}+\frac{1}{6C_{\perp1}^2}+\frac{1}{2C_{\perp2}^2}) \nonumber \\
   \text{zz direction    }I_{0\tau_i,R\tau_j}^{zz} &amp;=\frac{1}{N_k\sqrt{m_{\tau_i}m_{\tau_j}}}\frac{3k_BT}{N_0K_{\Delta}^2}(\frac{1}{3C_{//}^2}+\frac{2}{3C_{\perp1}^2})\label{eq:gammaFix}
\end{aligned}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(C_\lambda\)</span> is the group velocity that could be inferred
from
<span class="math notranslate nohighlight">\(C^2=\frac{1}{2}\frac{d\omega^2}{d^2k}\approx\frac{\omega^2_{k=0}+\omega^2_{k=2K}-2\omega^2_{k=K}}{2K_{int}^2}\)</span>.
Notice that the ’k’ in <span class="math notranslate nohighlight">\(C^2\)</span> should be calculate by interval
<span class="math notranslate nohighlight">\(K_{int}\)</span>(euclidean distance between neighbor k points on this
k-mesh). This is different from the <span class="math notranslate nohighlight">\(K_\Delta\)</span> calculate by
cubic-root the BZ volume. The latest modification based on
Eq. <a class="reference internal" href="#equation-gammafix">(8)</a> has been employed in the source
code file ’VA_math.f95’ and the convergence has been verified by
different k-mesh size choices.</p>
<dl class="citation">
<dt class="label" id="ref"><span class="brackets"><a class="fn-backref" href="#id1">Ref</a></span></dt>
<dd><ol class="upperalpha simple" start="7">
<li><p>Leibfried and W. Ludwig, in Solid State Physics, edited by F. Seitz and D. Turnbull (Academic, New York, 1961), Vol. 12.</p></li>
</ol>
</dd>
<dt class="label" id="broyden"><span class="brackets">Broyden</span></dt>
<dd><p>Broyden, C.G., 1965. A class of methods for solving nonlinear simultaneous equations. Mathematics of Computation 19, 577.</p>
</dd>
<dt class="label" id="esfarjani2018"><span class="brackets"><a class="fn-backref" href="#id2">Esfarjani2018</a></span></dt>
<dd><p>Ohno, K., Esfarjani, K., Kawazoe, Y., 2018. Computational materials science: From Ab Initio to Monte Carlo methods. 2nd ed., Springer Series in Solid-State Sciences, Berlin Heidelberg.</p>
</dd>
</dl>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="intro.html" class="btn btn-neutral float-left" title="1. Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="download.html" class="btn btn-neutral float-right" title="3. Download" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, University of Virginia.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>